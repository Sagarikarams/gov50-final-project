---
title: "Exploring USA Bureau of Labor Statistics"
author: "Sagarika Ramesh"
description: "Exploring how the inflation has affected different industries, unemployment and wage growth"
output:
  distill::distill_article:
    self_contained: false
---



## Project thoughts
I want to explore the USA Bureau of Labor Statistics (BLS) data. I will be analyzing different trends and patterns that exist in the data. Is inflation increasing faster than wage growth? If it is true, it would be difficult for lower-income households to meet their daily needs. The number of working hours, marital status, race, gender, labor productivity, and other factors could affect wage growth. We can also inspect how the COVID-19 pandemic has affected wage growth. The Consumer Price Index (CPI) is a statistical measure of change, over time, of the prices of goods and services in major expenditure groups(such as food, housing, apparel, transportation, and medical care)typically purchased by urban consumers. The Current Employment Statistics (CES) program produces detailed industry estimates of non-farm employment, hours, and earnings of workers on the payroll. 
My hypothesis is inflation is increasing faster than wage growth. The prices of most of the items have increased. We always hear people complain about how their spending power has decreased significantly. We can now check if it is true. 
Dataset is obtained from  https://www.bls.gov/cpi/ and https://www.bls.gov/ces/
My sample consists of revised seasonally adjusted Consumer Price Index and factors for All Urban Consumers during 2017-2021, average weekly earnings of all employees in different industries, and the cities in which they reside. My outcome variable measures wage growth. The monthly changes in the prices and wages are measured. This is used to calculate inflation and wage growth. I will use a regression analysis to examine the relationship between these two variables. A negative relationship between the two variables shows that they are not positively correlated, which means wages are not increasing with the increase in inflation.
Hence a negative relationship between the two variables would provide support for my hypothesis, and a positive relationship between the two variables would disprove my hypothesis.

```{r}
library(blscrapeR)
library(dplyr)
library(tidyverse)
library(infer)
library(broom)
library(lubridate)
library(ggplot2)
```

```{r}
cpi_all_items = read.csv("data/CPIAUCSL.csv")

cpi_all_items$Date <- ymd(cpi_all_items$DATE) 
cpi_all_items <- cpi_all_items|>
            rename("cpi_all_items" = CPIAUCSL)|>
            select(Date, cpi_all_items)

cpi_all_items$year <- year(cpi_all_items$Date)
cpi_all_items$month <- month(cpi_all_items$Date)

cpi_all_items <- cpi_all_items|>
  filter(month == 01 | month == 4 | month == 7| month == 10)|>
  select(Date, cpi_all_items)

cpi_all_items$CPI_change <- (cpi_all_items$cpi_all_items - lag(cpi_all_items$cpi_all_items))

glimpse(cpi_all_items)
head(cpi_all_items)
```

```{r}
eci_all  <- read.csv('data/ECIWAG.csv')

eci_all$Date <- ymd(eci_all$DATE) 
eci_all <- eci_all|>
            rename("eci" = ECIWAG)|>
            select(Date, eci)

eci_all$eci_change <- eci_all$eci - lag(eci_all$eci)

glimpse(eci_all)
head(eci_all)
```


```{r}
cpi_eci <- cpi_all_items |>
          inner_join(eci_all, by = 'Date')|>
          select(Date, CPI_change, eci_change)

cpi_eci$diff_btw_cpi_eci <- cpi_eci$CPI_change - cpi_eci$eci_change

head(cpi_eci)
```
```{r}
ggplot(data = cpi_eci, mapping = aes(y = CPI_change, x = eci_change)) + geom_point(color = "purple") + geom_smooth(method = "loess")+
  labs(
  y = "Change in CPI",
  x = "Change in ECI",
  title = "Change in ECI vs Change in CPI") + 
  scale_x_continuous( limits = c(0, 7),
                 breaks = c(0, 1,2,3,4,5,6,7)) +
  scale_y_continuous(limits = c(0, 7),
                 breaks = c(0, 1,2,3,4,5,6,7))
```


```{r}
ggplot(cpi_eci, aes(x = Date, y = diff_btw_cpi_eci)) + geom_line() + labs(x = "Date", y = "Difference between CPI and ECI", title = "Difference between CPI and ECI over a period of 10 years")
```

```{r}
employment_rate <- read.csv('data/LREM64TTUSM156S.csv')

employment_rate$Date <- ymd(employment_rate$DATE) 
employment_rate <- employment_rate|>
            rename("emp_rate" = LREM64TTUSM156S)|>
            select(Date, emp_rate)

glimpse(employment_rate)
head(employment_rate)
```

```{r}
gov_cur_expend <- read.csv('data/GEXPND.csv')

gov_cur_expend$Date <- ymd(gov_cur_expend$DATE) 
gov_cur_expend <- gov_cur_expend|>
            rename("gov_cur_expend" = GEXPND)|>
            select(Date, gov_cur_expend)

glimpse(gov_cur_expend)
head(gov_cur_expend)
```

```{r}
personal_consumption_expend <- read.csv('data/PCE.csv')

personal_consumption_expend$Date <- ymd(personal_consumption_expend$DATE) 
personal_consumption_expend <- personal_consumption_expend|>
            rename("pce" = PCE)|>
            select(Date, pce)

glimpse(personal_consumption_expend)
head(personal_consumption_expend)
```

```{r}
corp_profit_after_tax <- read.csv('data/CPATAX.csv')

corp_profit_after_tax$Date <- ymd(corp_profit_after_tax$DATE) 
corp_profit_after_tax <- corp_profit_after_tax|>
            rename("corp_profit" = CPATAX)|>
            select(Date, corp_profit)

glimpse(corp_profit_after_tax)
head(corp_profit_after_tax)
```

```{r}
finance_data <- cpi_eci|>
                left_join(gov_cur_expend, by = 'Date')

finance_data <- finance_data|>
                left_join(employment_rate, by = 'Date')

finance_data <- finance_data|>
                left_join(corp_profit_after_tax, by = 'Date')

finance_data <- finance_data|>
               left_join(personal_consumption_expend, by = 'Date')|>
                select(!(CPI_change:eci_change))



glimpse(finance_data)
head(finance_data)
```

```{r}
ggplot(data = finance_data, aes(x = emp_rate, y = diff_btw_cpi_eci)) + geom_point(color = "purple") +labs(x = "Employment Rate", y = "Difference between CPI and ECI", title = " Employment Rate vs Difference between CPI and ECI")
```
```{r}
ggplot(data = finance_data, aes(x = gov_cur_expend, y = diff_btw_cpi_eci)) + geom_point(color = "purple")+labs(x = "Government Current Expenditures", y = "Difference between CPI and ECI", title = "Government Current Expenditures vs Difference between CPI and ECI")
```
```{r}
ggplot(data = finance_data, aes(x = pce, y = diff_btw_cpi_eci)) + geom_point(color = "purple") + labs(x = "Personal Consumption Expenditures", y = "Difference between CPI and ECI", title = "Personal Consumption Expenditures vs Difference between CPI and ECI")
```
```{r}
ggplot(data = finance_data, aes(x = corp_profit, y = diff_btw_cpi_eci)) + geom_point(color = "purple") + labs(x = "Corporate Profits after Tax", y = "Difference between CPI and ECI", title = "Corporate Profits vs Difference between CPI and ECI")
```


```{r}
observed_mean = mean(finance_data$diff_btw_cpi_eci, na.rm = TRUE)
observed_mean
```

```{r}
set.seed(7890)

null_dist <- finance_data |>
              specify(response = diff_btw_cpi_eci) |>
              hypothesize(null = "point", mu = 0) |>
              generate(reps = 1000, type = "bootstrap") |>
              calculate(stat = "mean")
null_dist
```

```{r}
visualize(null_dist) + 
  shade_p_value(obs_stat = observed_mean, direction = "right")

```

```{r}
null_dist|> 
  get_p_value(obs_stat = observed_mean, direction = "right")
```


```{r}
finance_data.multreg <- lm(diff_btw_cpi_eci ~  emp_rate + gov_cur_expend + pce + corp_profit, data = finance_data) 

finance_data.multreg
tidy(finance_data.multreg) |> knitr::kable(digits = 3)
```

```{r}
modelsummary::modelsummary(finance_data.multreg, gof_map = c("nobs", "r.squared", "adj.r.squared"))
```

```{r}
totalwage_weekly <- read.csv("data/LES1252881500Q.csv")

totalwage_weekly$Date <- ymd(totalwage_weekly$DATE) 
totalwage_weekly <- totalwage_weekly|>
            rename("tt_wk_wage" = LES1252881500Q)|>
            select(Date, tt_wk_wage)

glimpse(totalwage_weekly)
tail(totalwage_weekly)
```
```{r}
ggplot(totalwage_weekly, aes(x = Date, y = tt_wk_wage)) + geom_line() + labs(x = "Date", y = "Dollars",title = "Median weekly earnings over 10 years for ages 16 and above")
```

```{r}
malewage_weekly <- read.csv("data/LES1252881800Q.csv")

malewage_weekly$Date <- ymd(malewage_weekly$DATE) 
malewage_weekly <- malewage_weekly|>
            rename("male_wk_wage" = LES1252881800Q)|>
            select(Date, male_wk_wage)

glimpse(malewage_weekly)
tail(malewage_weekly)
```
```{r}
ggplot(malewage_weekly, aes(x = Date, y = male_wk_wage)) + geom_line()+ labs(x = "Date", y = "Dollars", title = "Median weekly earnings over 10 years for male of ages 16 and above")
```

```{r}
femalewage_weekly <- read.csv("data/LES1252882700Q.csv")

femalewage_weekly$Date <- ymd(femalewage_weekly$DATE) 
femalewage_weekly <- femalewage_weekly|>
            rename("female_wk_wage" = LES1252882700Q)|>
            select(Date, female_wk_wage)

glimpse(femalewage_weekly)
tail(femalewage_weekly)
```

```{r}
ggplot(femalewage_weekly, aes(x = Date, y = female_wk_wage)) + geom_line() + labs(x = "Date", y = "Dollars", title = "Median weekly earnings over 10 years for female of ages 16 and above")
```
```{r}
wages <- totalwage_weekly |>
  inner_join(malewage_weekly, by = 'Date')

wages <- wages |>
        inner_join(femalewage_weekly, by = 'Date')
wages
```

```{r}
ggplot(wages, aes(x = male_wk_wage, y = female_wk_wage)) +
geom_point(color = "steelblue1") +
labs(
  x = "Median weekly earnings by Male",
  y = "Median weekly earnings by Female",
  title = "Median weekly earnings by Male vs Female") + 
  scale_x_continuous(labels = scales::dollar, 
                        limits = c(690, 1200),
                 breaks = c(600, 700, 800, 900, 1000, 1100, 1200)) +
  scale_y_continuous(labels = scales::dollar, 
                     limits = c(690, 1200),
                 breaks = c(600, 700, 800, 900, 1000, 1100, 1200))
```

```{r}
wages <- wages|>
        pivot_longer(
          cols = male_wk_wage:female_wk_wage,
          names_to = "Gender",
    values_to = "Wage"
  )|> mutate(Gender = if_else(Gender == "male_wk_wage", "Male", "Female"))|>
  select(-tt_wk_wage)

wages
```


```{r}
emp_rate_female <- read.csv('data/LREM25FEUSM156S.csv')

emp_rate_female$Date <- ymd(emp_rate_female$DATE) 
emp_rate_female <- emp_rate_female|>
            rename("emp_rate_female" = LREM25FEUSM156S)|>
            select(Date, emp_rate_female)

glimpse(emp_rate_female)
emp_rate_female
```

```{r}
emp_rate_male <- read.csv('data/LREM25MAUSM156S.csv')

emp_rate_male$Date <- ymd(emp_rate_male$DATE) 
emp_rate_male <- emp_rate_male|>
            rename("emp_rate_male" = LREM25MAUSM156S)|>
            select(Date, emp_rate_male)

glimpse(emp_rate_male)
emp_rate_male
```
```{r}
emp_rate <- emp_rate_male|>
            inner_join(emp_rate_female, by='Date')

emp_rate <- emp_rate|>
        pivot_longer(
          cols = emp_rate_male:emp_rate_female,
          names_to = "Gender",
    values_to = "emp_rate"
  )|> mutate(Gender = if_else(Gender == "emp_rate_male", "Male", "Female"))

emp_rate
```


```{r}
female_householder <- read.csv('data/OFHHFH.csv')

female_householder$Date <- ymd(female_householder$DATE) 
female_householder <- female_householder|>
            rename("female_householder" = OFHHFH)|>
            select(Date, female_householder)

glimpse(female_householder)
female_householder

```


```{r}
male_householder <- read.csv('data/OFHHMH.csv')

male_householder$Date <- ymd(male_householder$DATE) 
male_householder <- male_householder|>
            rename("male_householder" = OFHHMH)|>
            select(Date, male_householder)

glimpse(male_householder)
male_householder
```

```{r}
house_holder <- male_householder|>
            inner_join(female_householder, by='Date')


house_holder <- house_holder|>
        pivot_longer(
          cols = male_householder:female_householder,
          names_to = "Gender",
    values_to = "house_holder"
  )|> mutate(Gender = if_else(Gender == "male_householder", "Male", "Female"))

house_holder
```
```{r}
wages <- left_join(wages,emp_rate, by = c('Date'='Date', 'Gender'='Gender'))

wages <-left_join(wages,house_holder, by = c('Date'='Date', 'Gender'='Gender'))

glimpse(wages)
wages
```


```{r}
est_ate <-  wages |>
       specify(Wage ~ Gender) |>
      calculate(stat = "diff in means", order = c("Male", "Female"))
est_ate
```

```{r}
null_dist_wage_diff <- wages |>
                    specify(Wage ~ Gender) |>
                    hypothesize(null = "independence") |>
                    generate(reps = 1000, type = "permute") |>
                    calculate(stat = "diff in means", order = c("Male", "Female"))

ate_pval <- null_dist_wage_diff |>
get_p_value(obs_stat = est_ate, direction = "right")
ate_pval
```

```{r}
null_dist_wage_diff |>
visualize() +
shade_p_value(obs_stat = est_ate, direction = "right")
```


```{r}
wages.multreg <- lm(Wage ~  Gender + emp_rate + house_holder, data = wages) 

wages.multreg
tidy(wages.multreg) |> knitr::kable(digits = 3)
```

```{r}
modelsummary::modelsummary(wages.multreg, gof_map = c("nobs", "r.squared", "adj.r.squared"))
```


